steps:
  # Step 0: Clean the working directory
  - id: "Clean Directory"
    name: "ubuntu"
    entrypoint: bash
    args:
      - "-c"
      - |
        rm -rf ./* ./.*
        
  # Step 1: Clone the repository
  - id: "Clone Repository"
    name: "gcr.io/cloud-builders/git"
    args: ["clone", "https://github.com/madhurima-vanga/Amazon-Customer-Sentiment-Analyser.git", "."]
  
  # Step 2: Set up Python environment
  - id: "Setup Python Environment"
    name: "python:3.11"
    entrypoint: bash
    args:
      - "-c"
      - |
        python -m venv .venv
        source .venv/bin/activate
        pip install --upgrade pip
        pip install -r model/distilbert/requirements.txt

  # Step 3: Train the model
  - id: "Train Model"
    name: "python:3.11"
    entrypoint: bash
    args:
      - "-c"
      - |
        source .venv/bin/activate
        python model/distilbert/train.py
        mkdir -p model_output
        cp -r ./distilbert_sentiment_model model_output/

  # Step 4: Validate the model
  - id: "Validate Model"
    name: "python:3.11"
    entrypoint: bash
    args:
      - "-c"
      - |
        source .venv/bin/activate
        python model/distilbert/test.py --model-dir ./model_output/distilbert_sentiment_model

  # Step 5: Perform bias detection
  - id: "Bias Detection"
    name: "python:3.11"
    entrypoint: bash
    args:
      - "-c"
      - |
        source .venv/bin/activate
        python model/distilbert/test_bias.py --model-dir ./model_output/distilbert_sentiment_model



options:
  logging: CLOUD_LOGGING_ONLY